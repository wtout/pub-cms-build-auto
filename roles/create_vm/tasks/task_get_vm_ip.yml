---
# tasks to get vm ips
- set_fact:
    ipaddress1: "{{netconfig.ippool1[index|int - 1] if netconfig.ippool1 is defined else customer.octets + '.' + netconfig.octetpool1[index|int - 1]|string if index|int <= netconfig.octetpool1|length else ''}}"
    ipaddress2: "{{netconfig.ippool2[index|int - 1] if netconfig.ippool2 is defined else customer.octets + '.' + netconfig.octetpool2[index|int - 1]|string if index|int <= netconfig.octetpool2|length else ''}}"
  vars:
    index: "{{inventory_hostname | regex_replace('[^\\.]*([0-9][0-9])$', '\\1')}}"
  when: netconfig.ippool1 is defined or netconfig.octetpool1 != []
  tags: create_vm

- set_fact:
    ansible_host: "{{ipaddress1}}"
  tags: create_vm

- set_fact:
    netconfig: "{{netconfig|default({}) | combine(new_item, recursive=true)}}"
  vars:
    new_item: "{'{{item.key}}': '{{item.value}}'}"
  loop:
    - { key: 'ipaddress1', value: '{{ipaddress1}}'}
    - { key: 'ipaddress2', value: '{{ipaddress2}}'}
  no_log: true
  tags: create_vm
