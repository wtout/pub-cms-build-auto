---
# Tasks to check the licensed state on the EM7 DB
- block:
  - name: check licensed_state
    ansible.builtin.shell: |
      sudo -S licensed_state <<< {{ ansible_ssh_pass }}
    register: reg_lic_state
    args:
      warn: no
    check_mode: no
    ignore_errors: yes
    no_log: yes
  - debug:
      msg: "{{ reg_lic_state|replace(ansible_ssh_pass, 'obfuscated') }}"
  - name: define lic_status
    ansible.builtin.set_fact:
      licensed_status: "{{ reg_lic_state.stdout }}"
    when: reg_lic_state is failed
  tags: sanity
