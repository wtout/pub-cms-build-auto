---
# Tasks to check the cronjobs
- block:
  - name: check if there is a backup cronjob
    ansible.builtin.shell: |
      {{ 'sudo -S' if ansible_user != 'root' else '' }} crontab -l {{ '<<< ' + ansible_ssh_pass if ansible_user != 'root' else '' }} | grep qs
    register: reg_bk_cronjob
    ignore_errors: yes
    args:
      warn: false
    check_mode: no
    no_log: "{{ 'yes' if ansible_user != 'root' else 'no' }}"
  - debug:
      msg: "{{ reg_bk_cronjob|replace(ansible_ssh_pass, 'obfuscated') }}"
    when:
      - reg_bk_cronjob.stdout_lines|length == 0
  - name: define rly_backup_cronjob_status
    ansible.builtin.set_fact:
      rly_backup_cronjob_status: 'No backup cronjob found'
    when:
      - reg_bk_cronjob.stdout_lines|length == 0
  tags: sanity
  