---
# Tasks to check splunk service status
- block:
  - name: check splunk service status
    ansible.builtin.shell: |
      $(which su) splunk -c '/opt/splunk/bin/splunk status'
    check_mode: no
    register: spl_status
    ignore_errors: true
  - name: define splunk status
    ansible.builtin.set_fact:
      splunk_status: 'splunk service is not running'
    when:
      - inventory_hostname is search('spl(dpl01|mas01|src|ind)')
      - spl_status is failed
  - name: define splunk status
    ansible.builtin.set_fact:
      splunk_status: 'splunk service is running'
    when:
      - inventory_hostname is search('spl(dpl|mas)02')
      - spl_status is succeeded
  when: inventory_hostname is search('spl')
  tags: sanity
