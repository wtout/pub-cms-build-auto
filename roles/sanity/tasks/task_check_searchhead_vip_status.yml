---
# Tasks to check the search head VIP in application.properties file
- block:
  - name: check if /opt/CSCO-CMS/relayweb/conf/application.properties exists
    ansible.builtin.stat:
      path: '/opt/CSCO-CMS/relayweb/conf/application.properties'
    register: reg_app_prop_file
  - name: define rly_splsrcvip_status
    ansible.builtin.set_fact:
      rly_splsrcvip_status: '/opt/CSCO-CMS/relayweb/conf/application.properties is not found'
    when: not reg_app_prop_file.stat.exists
  - block:
    - name: get splunk search head VIP
      ansible.builtin.shell: |
        grep davSplunkIP /opt/CSCO-CMS/relayweb/conf/application.properties | cut -d '=' -f2
      register: reg_splsrcvip_config
      check_mode: no
      ignore_errors: yes
    - name: define rly_splsrcvip_status
      ansible.builtin.set_fact:
        rly_splsrcvip_status: "Splunk Search head VIP is not configured correctly in /opt/CSCO-CMS/relayweb/conf/application.properties. Got {{ reg_splsrcvip_config.stdout }} instead of 'splunk-search-head-vip'"
      when: reg_splsrcvip_config.stdout != 'splunk-search-head-vip'
    when: reg_app_prop_file.stat.exists
  tags: sanity