---
# tasks to update drbd res file on EM7 VM
- block:
  - name: find default_host
    shell: grep creation_host /etc/lvm/backup/em7vg | grep -v localhost
    check_mode: no
    register: default_host
  - name: define string to replace
    set_fact:
      string_to_replace: "{{default_host.stdout.split(' ')[4]}}"
  - name: Update drbd file on VM
    replace:
      path: '/etc/drbd.d/r0.res'
      regexp: '{{default_host.stdout.split(" ")[4][:-2]}}'
      replace: '{{customer.name_prefix}}{{vm.name}}'
    notify: restart drbd
  when: "'em7db' in group_names"
  become: "{{true if 'em7' in group_names else false}}"
  tags: vms
