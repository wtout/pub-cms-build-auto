---
# tasks file to create vms
- block:
  - include_tasks: task_create_folder.yml
    when:
      - hostvars[groups['vcenter'][0]]['information']['deptype'] == 'h'
    run_once: true
  - include_tasks: task_create_cluster.yml
    when:
      - hostvars[groups['vcenter'][0]]['information']['deptype'] == 'a'
    run_once: true
  - include_tasks:
      file: task_create_vm_pair.yml
      apply:
        vars:
          vm_group: "{{item}}"
    loop: "{{group_list}}"
    when: inventory_hostname in groups[item]
  - name: flush handlers
    meta: flush_handlers
  tags: vms
