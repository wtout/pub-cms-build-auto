---
# Tasks to configure snmpd on the VM
- block:
  - name: get nic ens160 MAC address 
    shell: ip link show ens160 | grep ether | awk '{print $2}'
    register: ens160_mac
  - name: update snmpd.conf with ens160 MAC address
    lineinfile:
      path: '/etc/snmp/snmpd.conf'
      line: "engineid {{ens160_mac.stdout | replace(':', '')}}"
    notify: restart snmpd service 
  when: "'em7' in group_names"
  become: "{{true if 'em7' in group_names else false}}"
  tags: vms
