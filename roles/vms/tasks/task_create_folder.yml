---
# Tasks to create the VM folder
- block:
  - name: Create the '{{hostvars[groups['vcenter'][0]]['information']['folder']}}/{{customer.name}}' folder
    vcenter_folder:
      hostname: "{{hostvars[groups['vcenter'][0]]['information']['address']}}"
      username: "{{hostvars[groups['vcenter'][0]]['credentials']['username']}}"
      password: "{{hostvars[groups['vcenter'][0]]['credentials']['password']}}"
      datacenter_name: "{{datacenter.name}}"
      folder_name: "{{customer.name}}"
      folder_type: vm
      parent_folder: "{{hostvars[groups['vcenter'][0]]['information']['folder']}}"
      state: present
      validate_certs: no
    register: cust_folder
  - debug: var=cust_folder

  delegate_to: "{{groups['bastion'][0] if (groups['bastion'] | length >= 1 and bastion.address != [] and bastion.address != ['']) else 'localhost'}}"
  tags: vms
