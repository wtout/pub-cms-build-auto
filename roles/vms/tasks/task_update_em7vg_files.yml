---
# tasks to update em7vg files on EM7 VM
- block:
  - name: find em7vg files
    find:
      path: '/etc/lvm'
      patterns: 'em7vg*'
      recurse: yes
    register: em7vg
  - name: Update em7vg files on VM
    replace:
      path: "{{task_item.path}}"
      regexp: '^(creation_host = ").*(".*)$'
      replace: '\g<1>{{customer.name_prefix}}{{vm.name}}{{inventory_hostname[-2:]}}\g<2>'
    loop: "{{em7vg.files}}"
    loop_control:
      loop_var: task_item
  when: "'em7' in group_names"
  become: "{{true if 'em7' in group_names else false}}"
  tags: vms
