---
# Tasks to create and configure VM pairs
- block:
  - name: "{{ auto_dir + '/roles/vm_creation' }}: get vm datastore"
    include_role:
      name: "{{ auto_dir + '/roles/vm_creation' }}"
      tasks_from: task_get_vm_datastore.yml
    when:
      - hostvars[groups['vcenter'][0]]['information']['datastore_cluster'] == ''
  - include_tasks: task_create_kickstart_iso.yml
  - include_tasks: task_copy_kickstart_iso_to_vsphere.yml
  - include_tasks: task_deploy_iso.yml
  - include_tasks: task_update_disks.yml
  - include_tasks: task_delete_kickstart_files.yml
  - include_tasks: task_update_default_route.yml
  - name: flush handlers
    meta: flush_handlers
  tags: vm_creation
