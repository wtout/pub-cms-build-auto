---
# tasks to update /etc/silo.conf on EM7 VM
- block:
  - name: Update dbpasswd in silo.conf on VM
    replace:
      path: /etc/silo.conf
      regexp: '^({{ task_item.param }}) (.*)$'
      replace: '\g<1> {{ task_item.value }}'
    loop:
      - { param: 'dbpasswd =', value: "{{ vars[('STG' if datacenter.primary.name == 'RTP-Staging' else '') + 'EM7DBPPP_PASS'] }}" }
    loop_control:
      loop_var: task_item
    no_log: true
    when:
      - hostvars[groups['em7db']|first]['ansible_ssh_pass'] == postppp
  become: "{{ true if ansible_user != 'root' else false }}"
  tags: [ 'drdb_configuration', 'never' ]
