---
# Task file to add DNS records
- name: Add DNS record
  nsupdate:
    server: "{{ dns_server }}"
    record: "{{ vm.name }}"
    value: "{{ netconfig.ipaddress1 }}"
  loop: "{{ sysconfig.dns_servers }}"
  loop_control:
    loop_var: dns_server
  delegate_to: "{{ groups['bastion'][0] if (groups['bastion'] | length >= 1 and bastion.address != [] and bastion.address != ['']) else 'localhost' }}" 
  tags: ['build_infra_nodes', 'never']