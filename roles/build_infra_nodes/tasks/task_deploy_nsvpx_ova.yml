---
# Task file to deploy NSVPX from ova
- name: Deploy Load Balancers from OVA
  vmware_deploy_ovf:
    hostname: "{{ hostvars[groups['vcenter'][0]]['information']['address'] }}"
    username: "{{ hostvars[groups['vcenter'][0]]['credentials']['username'] }}"
    password: "{{ hostvars[groups['vcenter'][0]]['credentials']['password'] }}"
    datacenter: "{{ datacenter.name }}"
    disk_provisioning: "{{ 'thin' if hostvars[groups['vcenter'][0]]['information']['datacenter'] == 'PAE-HX-DC' else 'thick' }}"
    cluster: "{{ hostvars[groups['vcenter'][0]]['information']['drcluster'] if inventory_hostname is search('dr') else hostvars[groups['vcenter'][0]]['information']['cluster'] }}"
    datastore: "{{ 'HX-Datastore-Cluster' if hostvars[groups['vcenter'][0]]['information']['datacenter'] == 'PAE-HX-DC' else vm_ds }}"
    folder: "{{ datacenter.name }}/vm/{{ fldr_name }}"
    name: "{{ vm.name }}"
    networks: {}
    ova: "{{ ova_dir }}/{{ customer.release }}/NSVPX-ESX-11.1-53.11_nc.ovf"
    power_on: no
    allow_duplicates: no
    validate_certs: no
  environment:
    http_proxy: ''
    https_proxy: ''
  register: nsvpx_deployment
  async: 1200
  poll: 0
  delegate_to: "{{ groups['bastion'][0] if (groups['bastion'] | length >= 1 and bastion.address != [] and bastion.address != ['']) else 'localhost' }}"
  tags: ['build_infra_nodes', 'never']