---
# tasks file to add vswitches
- name: Add vSwitch
  vmware_vswitch:
    hostname: "{{ information.address }}"
    username: "{{ credentials.username }}"
    password: "{{ credentials.password }}"
    esxi_hostname: "{{ resource }}"
    validate_certs: false
    switch: "vSwitch{{ counter | int }}"
    nics: "vmnic{{ counter | int }}"
  loop: "{{ range(0, 5)|list }}"
  loop_control:
    loop_var: counter
  delegate_to: "{{ groups['bastion'][0] if (groups['bastion'] | length >= 1 and bastion.address != [] and bastion.address != ['']) else 'localhost' }}"
  run_once: true
  tags: ['configure_infra', 'build_infra_nodes', 'capcheck', 'vm_creation']
