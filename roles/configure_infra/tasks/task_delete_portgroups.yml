---
# tasks file to delete portgroups
- name: Define existing portgroups
  vmware_portgroup_info:
    hostname: "{{ information.address }}"
    username: "{{ credentials.username }}"
    password: "{{ credentials.password }}"
    esxi_hostname: "{{ resource }}"
    validate_certs: no
  register: existing_portgroups

- include_tasks:
    file: task_delete_portgroup.yml
    apply:
      vars:
        portgroup: "{{ portgroup }}"
        resource: "{{ resource }}"
  loop: "{{ (existing_portgroups.hosts_portgroup_info|dict2items|first).value }}"
  loop_control:
    loop_var: portgroup
  tags: ['configure_infra', 'build_infra_nodes', 'capcheck', 'vm_creation']