---
# Task file to delete cluster    
- block:
  - name: Delete '{{ hostvars[groups['vcenter'][0]]['information']['cluster'] }}' cluster
    vmware_cluster:
      hostname: "{{ information.address }}"
      username: "{{ credentials.username }}"
      password: "{{ credentials.password }}"
      datacenter: "{{ datacenter.name }}"
      cluster_name: "{{ hostvars[groups['vcenter'][0]]['information']['cluster'] }}"
      state: absent
      validate_certs: no
    register: cust_drcluster

  - name: Delete '{{ hostvars[groups['vcenter'][0]]['information']['drcluster'] }}' cluster
    vmware_cluster:
      hostname: "{{ information.address }}"
      username: "{{ credentials.username }}"
      password: "{{ credentials.password }}"
      datacenter: "{{ datacenter.name }}"
      cluster_name: "{{ hostvars[groups['vcenter'][0]]['information']['drcluster'] }}"
      state: absent
      validate_certs: no
    register: cust_drcluster
    when: customer.disaster_recovery
  tags: ['configure_infra', 'build_infra_nodes', 'capcheck', 'vm_creation']