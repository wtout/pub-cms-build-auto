---
# tasks file to create port groups
- name: Create port groups
  vmware_portgroup:
    hostname: "{{ information.address }}"
    username: "{{ credentials.username }}"
    password: "{{ credentials.password }}"
    hosts: "{{ resource }}"
    switch: "{{ portgroup_item.switch }}"
    portgroup: "{{ portgroup_item.name }}"
    vlan_id: "{{ portgroup_item.vlan_id | default('0') }}"
    teaming:
      active_adapters: "{{ portgroup_item.active_adapter }}"
    validate_certs: no
  loop:
    - { name: "{{ customer_prefix }}-Customer-Net-Internet", switch: 'vSwitch0', active_adapter: 'vmnic0' }
    - { name: "{{ customer_prefix }}-Customer-Net-Outside", switch: 'vSwitch1', active_adapter: 'vmnic1' }
    - { name: "{{ customer_prefix }}-Internal-Net", switch: 'vSwitch2', active_adapter: 'vmnic2', vlan_id: 100 }
    - { name: "{{ customer_prefix }}-Loadbalancer-Net", switch: 'vSwitch2', active_adapter: 'vmnic2', vlan_id: 120 }
    - { name: "{{ customer_prefix }}-Customer-Net-Inside", switch: 'vSwitch3', active_adapter: 'vmnic3', vlan_id: 200 }
    - { name: "{{ customer_prefix }}-EM7-DB-Heartbeat-Link", switch: 'vSwitch4', active_adapter: 'vmnic4' }
  loop_control:
    loop_var: portgroup_item
  run_once: true
  tags: ['infra_configure', 'infra_build_nodes', 'capcheck', 'vm_creation']
