---
# tasks file to create port groups
- name: Create port groups
  vmware_portgroup:
    hostname: "{{ information.address }}"
    username: "{{ credentials.username }}"
    password: "{{ credentials.password }}"
    hosts: "{{ resource }}"
    switch: "{{ new_portgroup.switch }}"
    portgroup: "{{ new_portgroup.name }}"
    vlan_id: "{{ new_portgroup.vlan_id | default('0') }}"
    teaming:
      active_adapters: "{{ new_portgroup.active_adapter }}"
    validate_certs: no
  loop: "{{ portgroups }}"
  loop_control:
    loop_var: new_portgroup
  run_once: true
  tags: ['infra_configure', 'infra_build_nodes', 'capcheck', 'vm_creation']