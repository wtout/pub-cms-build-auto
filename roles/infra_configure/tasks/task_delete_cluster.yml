---
# Task file to delete cluster    
- block:
  - name: Delete '{{ hostvars[groups['vcenter'][0]]['information']['cluster'] }}' cluster
    vmware_cluster:
      hostname: "{{ information.address }}"
      username: "{{ credentials.username }}"
      password: "{{ credentials.password }}"
      datacenter: "{{ datacenter.name }}"
      cluster_name: "{{ hostvars[groups['vcenter'][0]]['information']['cluster'] }}"
      state: absent
      validate_certs: no
    register: cust_drcluster

  - name: Delete '{{ hostvars[groups['vcenter'][0]]['information']['drcluster'] }}' cluster
    vmware_cluster:
      hostname: "{{ information.address }}"
      username: "{{ credentials.username }}"
      password: "{{ credentials.password }}"
      datacenter: "{{ datacenter.name }}"
      cluster_name: "{{ hostvars[groups['vcenter'][0]]['information']['drcluster'] }}"
      state: absent
      validate_certs: no
    register: cust_drcluster
    when: customer.disaster_recovery
  delegate_to: "{{ groups['bastion'][0] if (groups['bastion'] | length >= 1 and bastion.address != [] and bastion.address != ['']) else 'localhost' }}"
  tags: [ 'infra_configure', 'infra_build_nodes', 'capcheck' ]