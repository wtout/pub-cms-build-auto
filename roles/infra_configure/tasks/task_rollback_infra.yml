---
# tasks file for deleting datastores
- block:
  - name: rollback HA datastores
    include_tasks:
      file: "{{ rollback_task_item }}"
      apply:
        vars:
          resource: "{{ resource_item }}"
    loop: "{{ resources[:2] }}"
    loop_control:
      loop_var: resource_item
    when: ansible_play_batch | reject('search', 'dr|vcenter|bastion|puppet|nexus') | list | length >= 1
  - name: rollback DR datastores
    include_tasks:
      file: "{{ rollback_task_item }}"
      apply:
        vars:
          resource: "{{ resource_item }}"
    loop: "{{ resources[2:] }}"
    loop_control:
      loop_var: resource_item
    when: ansible_play_batch | select('search', 'dr') | list | length >= 1
  delegate_to: "{{ groups['bastion'][0] if (groups['bastion'] | length >= 1 and bastion.address != [] and bastion.address != ['']) else 'localhost' }}"
  tags: [ 'infra_configure', 'infra_build_nodes', 'capcheck' ]
