---
- name: define configure_ssh_keys
  set_fact:
    configure_ssh_keys: true
  when:
    - deploy | default(false) | bool
    - inventory_hostname in groups['bastion']
    - bastion.address != []
    - bastion.address != ['']
  tags: ssh_keys

- name: define rollback_ssh_keys
  set_fact:
    rollback_ssh_keys: true
  when:
    - rollback | default(false) | bool
    - inventory_hostname in groups['bastion']
    - bastion.address != []
    - bastion.address != ['']
  tags: ssh_keys

- name: define capcheck
  set_fact:
    capcheck: true
  when:
    - deploy | default(false) | bool
    - inventory_hostname in groups['vcenter']
  tags: ['capcheck', 'vm_creation']

- name: define get_release
  set_fact:
    get_release: true
  when:
    - deploy | default(false) | bool
    - inventory_hostname in groups['stack'] or (customer.disaster_recovery and inventory_hostname in groups['dr'])
  tags: get_release

- name: define create_vms
  set_fact:
    create_vms: true
  when:
    - deploy | default(false) | bool
    - inventory_hostname in groups['stack'] or (customer.disaster_recovery and inventory_hostname in groups['dr'])
  tags: vm_creation

- name: define rollback_vms
  set_fact:
    rollback_vms: true
  when:
    - rollback | default(false) | bool
    - inventory_hostname in groups['stack'] or (customer.disaster_recovery and inventory_hostname in groups['dr'])
  tags: vm_creation

- name: define configure_vms
  set_fact:
    configure_vms: true
  when:
    - deploy | default(false) | bool
    - inventory_hostname in groups['stack'] or (customer.disaster_recovery and inventory_hostname in groups['dr'])
  tags: vm_configuration

- name: define push_puppet
  set_fact:
    push_puppet: true
  when:
    - deploy | default(false) | bool
    - inventory_hostname in groups['stack'] or (customer.disaster_recovery and inventory_hostname in groups['dr'])
  tags: puppet

- name: define rollback_puppet
  set_fact:
    rollback_puppet: true
  when:
    - rollback | default(false) | bool
    - inventory_hostname in groups['stack'] or (customer.disaster_recovery and inventory_hostname in groups['dr'])
  tags: puppet

#- name: define check_requiretty
#  set_fact:
#    check_requiretty: true
#  when:
#    - deploy | default(false) | bool
#    - inventory_hostname in groups['stack'] or (inventory_hostname in groups['dr'] and customer.disaster_recovery)
#  tags: check_requiretty
