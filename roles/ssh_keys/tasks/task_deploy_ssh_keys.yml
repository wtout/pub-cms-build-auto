---
# tasks to deploy ssh_keys to remote server(s)
- block:
  - block:
    - stat:
        path: "{{ LOCAL_SSH_DIR }}/{{ SSH_KEY_FILE }}"
      register: privkey
    - stat:
        path: "{{ LOCAL_SSH_DIR }}/{{ SSH_KEY_FILE }}.pub"
      register: pubkey
    delegate_to: localhost
    run_once: true
  - name: copy the SSH keys to remote host
    authorized_key:
      user: "{{ ansible_user }}"
      state: present
      key: "{{ lookup('file', '{{ LOCAL_SSH_DIR }}/{{ SSH_KEY_FILE }}.pub') }}"
    when:
      - privkey.stat.exists and pubkey.stat.exists
      - hostvars[inventory_hostname]['ansible_host'] != ''
  tags: ssh_keys
