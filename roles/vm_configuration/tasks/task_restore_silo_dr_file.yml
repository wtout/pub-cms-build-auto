---
# tasks to restore /etc/silo.conf on EM7 portal VM
- block:
  - name: Restore dbpasswd in silo.conf on DR portal
    replace:
      path: /etc/silo.conf
      regexp: '^({{ task_item.param }}) {{ task_item.regexp}}$'
      replace: '\g<1> {{ task_item.value }}'
    loop:
      - { param: 'dbpasswd =', regexp: '{{ EM7PPP_PASS }}', value: 'em7admin' }
    loop_control:
      loop_var: task_item
    when:
      - inventory_hostname is search('drem7prt')
    no_log: true
  when: inventory_hostname is search('em7')
  become: "{{ true if inventory_hostname is search('em7') else false }}"
  tags: vm_configuration
