---
# tasks to install packages and upgrade kernel on non-EM7 VM
- block:
  - name: install packages and upgrade kernel
    yum:
      name: "{{pkg_item.name}}"
      state: "{{pkg_item.state}}"
    loop:
      - { name: 'expect', state: 'installed' }
      - { name: 'kernel', state: 'latest' }
      - { name: 'perl-Config-IniFiles', state: 'installed' }
    loop_control:
      loop_var: pkg_item

  - block:
    - name: create /root/bin directory
      file:
        path: /root/bin
        state: directory
    - name: install nfs-utils
      yum:
        name: nfs-utils
        state: installed
      notify: start nfs
    when:
      - inventory_hostname is search('rly')
  become: "{{ true if inventory_hostname is search('em7') else false}}"
  when:
    - inventory_hostname is not search('em7')
  tags: vm_configuration
