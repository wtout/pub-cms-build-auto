---
# tasks to update /etc/exports on VM
- block:
  - name: delete content of /et/exports
    file:
      content: ''
      path: /etc/exports
      force: yes
  - name: Add the lines to /etc/exports file
    lineinfile:
      path: /etc/exports
      line: "{{line_item}}"
    loop:
      - /backup/em7/config {{customer.octets}}.13(rw,all_squash,anonuid=600,anongid=600)
      - /backup/em7/full {{customer.octets}}.13(rw,all_squash,anonuid=600,anongid=600) 
      - /backup/em7/config {{customer.octets}}.14(rw,all_squash,anonuid=600,anongid=600)
      - /backup/em7/full {{customer.octets}}.14(rw,all_squash,anonuid=600,anongid=600)
    loop_control:
      loop_var: line_item
    register: exports_update
#  - name: reload /etc/exports
#    command: exportfs -ar
#    when:
#      - not ansible_check_mode
  become: "{{true if 'em7' in group_names else false}}"
  when:
    - "'relay' in group_names"
  tags: vm_configuration
