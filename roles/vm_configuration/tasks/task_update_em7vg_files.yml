---
# tasks to update em7vg files on EM7 VM
- block:
  - name: find default_host
    shell: grep creation_host /etc/lvm/backup/em7vg | grep -v {{sysconfig.domain_name}}
    check_mode: no
    register: default_host
  - name: define string to replace
    set_fact:
      string_to_replace: "{{default_host.stdout.split(' ')[4][:-2]}}"
  - name: find em7vg files
    find:
      path: '/etc/lvm'
      patterns: 'em7vg*'
      recurse: yes
    register: em7vg
  - name: Update em7vg files on VM
    replace:
      path: "{{task_item.path}}"
      regexp: '{{string_to_replace}}'
      replace: '{{customer.name_prefix}}{{vm.name}}'
    loop: "{{em7vg.files}}"
    loop_control:
      loop_var: task_item
  when: "'em7' in group_names"
  become: "{{true if 'em7' in group_names else false}}"
  tags: vm_configuration
